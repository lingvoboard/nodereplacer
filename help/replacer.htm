<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <link rel="stylesheet" href="files/main.css" />
  <title>ИНСТРУКЦИЯ</title>
</head>
<body>
  <div class="c1">
    <h1>ИНСТРУКЦИЯ К СКРИПТУ nodereplacer.js</h1>
  </div>

  <p>Содержание инструкции:

  <ul>
    <li><a href="index.htm">Общий раздел</a>
    </li>

    <li><b>Замены</b>
    </li>

    <li><a href="plugins.htm">Дополнительные плагины</a>
    </li>

    <li><a href="javascript.htm">Раздел для программистов</a>
    </li>
  </ul>

  <div class="c1">
    ЗАМЕНЫ
  </div>

  <p><span class="subs">Содержание раздела</span>:

  <p>&nbsp;&nbsp;<a href="#form">1.</a> Форматы макросов в списке замен<br>
  &nbsp;&nbsp;<a href="#exam">2.</a> Дополнительные примеры<br>
  &nbsp;&nbsp;<a href="#comm">3.</a> Комментирование макросов<br>
  &nbsp;&nbsp;<a href="#uni">4.</a> Категории символов Unicode

  <p><span><a class="mark" href="#form" id="form" name="form">#</a></span> <span class="subs">Форматы макросов в списке замен</span>

  <p>1)Для простых замен:

  <p>^(.+?)\t\|\t(.*)$

  <p>Примечание:<br>
  ^(.+?) - <i>левая часть.</i><br>
  \t\|\t - <i>разделитель.</i><br>
  (.*)$ - <i>правая часть.</i>

  <p>Пример использования:

  <pre>
[/b]    |       &lt;/B&gt;
[b]     |       &lt;B&gt;
[/c]    |       &lt;span class=color&gt;
[c]     |       &lt;/span&gt;
[i]     |       &lt;I&gt;
[/i]    |       &lt;/I&gt;
[/m]    |       &lt;/div&gt;
[m1]    |       &lt;div class=m1&gt;
[p]     |       &lt;div&gt;
[/p]    |       &lt;/div&gt;
</pre>
  <p>2)Для замен с использованием регулярных выражений:

  <p>^(.+?)\t\|(i?)\|\t(.*)$

  <p>Пример использования:

  <pre>
\[(\/?)(b|i|u|sub|sup)\]        ||      &lt;$1$2&gt;
\[i\]   ||      
^(&lt;[a-z]+&gt;)$      |i|     $1</pre><br>
  |i| - игнорировать регистр.
  <p>Ниже список специальных символов, которые в регулярных выражениях следует обязательно экранировать для превращения их в литеральные (если требуется):

  <pre>[]\^$.|?*+()</pre>
  <p>В правой части это можно не делать.

  <p>Пример:

  <pre>
(\[\]\\\^\$\.\|\?\*\+\(\))      ||      []\^$.|?*+()$1
</pre>
  <p>Символ ' и " можно не экранировать в обоих частях.

  <div class="Achtung">
    <br>
    Точка в регулярном выражении обозначает любой символ, кроме перевода строки: \n \r \u2028 or \u2029. Для поиска любого символа, включая переводы строк нужно использовать [\s\S] или [^].
  </div>

  <p><span><a class="mark" href="#exam" id="exam" name="exam">#</a></span> <span class="subs">Дополнительные примеры</span>

  <p>Расстановка тэгов [m1], [/m] в DSL файле:

  <pre>
^([\t\x20]+)([^\t\x20].*)$      ||      $1[m1]$2[/m]
</pre>
  <p><i>Возможный результат</i>:

  <pre>
абажур
        <b>[m1]</b>АБАЖ’УР[trn], -а, [p][c]м.[/c][/p] Колпак для лампы, светильника. [i]Зелёный а.[/i]<b>[/m]</b>
        <b>[m1]</b>[b]|[/b] [p][c]прил.[/c][/p] [b]абажурный[/b], -ая, -ое.[/trn]<b>[/m]</b>
</pre>
  <p><i>Это регулярное выражение работает при построчной и постатейной обработке (-rt или -rd).<br>
  Но в последнем случае файл должен иметь словарную структуру.<br>
  И при постатейной обработке ^ - это не начало статьи (в данном случае), а $ - не конец.<br>
  Ибо точка не захватывает \n. Чтобы охватить всю статью надо заменить точку на [^].</i>
  

  <p>При использовании [^] вместо точки и постатейной обработке (-rd):

  <pre>
^([\t\x20]+)([^\t\x20]<b>[^]</b>*)$     ||      $1[m1]$2[/m]
</pre>
  <p><i>Результат будет таким</i>:

  <pre>
абажур
        <b>[m1]</b>АБАЖ’УР[trn], -а, [p][c]м.[/c][/p] Колпак для лампы, светильника. [i]Зелёный а.[/i]
        [b]|[/b] [p][c]прил.[/c][/p] [b]абажурный[/b], -ая, -ое.[/trn]<b>[/m]</b>
</pre>
  <div class="Achtung">
    <br>
    Использование пробелов вместо табуляторов в разделителях макросов недопустимо.
  </div>

  <p>Если скрипт прервал работу с сообщением об ошибке, то первым делом рекомендуется проверить список замен на предмет наличия в нём невалидных макросов.<br>
  Пример невалидного макроса - макрос в разделителе которого вместо табулятора использован пробел.<br>
  Многие продвинутые редакторы дают возможность визуализировать пробельные символы, используйте эту фичу для проверки.

  <p><span><a class="mark" href="#comm" id="comm" name="comm">#</a></span> <span class="subs">Комментирование макросов</span>

  <p>Скрипт игнорирует макросы в строках, которые начинаются с //

  <p>Пример:

  <pre>
//[b]   |       &lt;B&gt;
//\[i\] ||      
</pre>
  <p><span><a class="mark" href="#uni" id="uni" name="uni">#</a></span> <span class="subs">Категории символов Unicode</span>

  <p>\p{L}, \P{L}, \p{N}, \P{Number}, \p{Greek} и т. д.

  <p>Их можно использовать в регулярных выражениях только если скрипт запускается с ключом <span class="comline">--harmony_regexp_property</span><br>
  На данном этапе (Node v8.5.0) реализация этой возможности находится в разработке.<br>
  Что поддерживается уже, а что еще нет пока непонятно. В официальной докуметации это не отражено. Надо тестировать.

  <p>Пример:

  <pre>
(\p{L}+)        ||      [i]$1[/i]
(\p{Lu}+)       ||      [i]$1[/i]
(\p{Script=Latin}+)     ||      [i]$1[/i]
(\p{Script=Greek}+)     ||      [i]$1[/i]
(\p{Script=Cyrillic}+)  ||      [i]$1[/i]
(\p{General_Category=Number}+)  ||      [i]$1[/i]
</pre>
  <p>Информацию для экспериментов с категориями можно брать отсюда:

  <ul>
    <li><a href="http://www.unicode.org/reports/tr44/">Unicode Character Database</a>
    </li>

    <li><a href="http://www.unicode.org/charts/charindex.html">Unicode® Character Name Index</a>
    </li>

    <li><a href="http://www.i18nguy.com/unicode/codepages.html">Character Sets And Code Pages At The Push Of A Button</a>
    </li>
  </ul>

  <hr />
</body>
</html>
