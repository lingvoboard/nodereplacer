# ИНСТРУКЦИЯ К СКРИПТУ nodereplacer.js

### Содержание инструкции:

* [Установка](install.md)
* [Общий раздел](index.md)
* **Замены**
* [Дополнительные плагины](plugins.md)
* [Раздел для программистов](javascript.md)

ЗАМЕНЫ

### Содержание раздела:

1. [Форматы макросов в списке замен](#Форматы-макросов-в-списке-замен)
2. [Дополнительные примеры](#Дополнительные-примеры)
3. [Комментирование макросов](#Комментирование-макросов)
4. [Категории символов Unicode](#Категории-символов-unicode)

### Форматы макросов в списке замен

Макрос замен состоит из 2ух частей: `что найти` и `чем заменить`. Разделитель между частями — последовательность табуляторов и вертикальных слэшей _(подробнее см. ниже)_.  

![warning.png](./../warning.png) Недопустимо использовать в разделителях вместо табуляторов пробелы. Если скрипт прервал работу с сообщением об ошибке, то первым делом рекомендуется проверить список замен на предмет наличия в нём невалидных макросов. Одна из причин невалидности — использование пробелов вместо табуляторов в разделителе. Определить подобную подмену можно и визуально — многие продвинутые текстовые редакторы отображают непечатаемые символы при помощи специальных значков _(обычно пробел в виде точки по центру строки, табулятор — в виде стрелки)_.  

#### Формат макроса для простых замен

```regex
^(.+?)\t\|\t(.*)$
```

Примечание:  

`^(.+?)` - левая часть.</br>
`\t\|\t` - разделитель.</br>
`(.*)$` - правая часть.</br>

Пример использования:  

```
[/b]	|	</B>
[b]	|	<B>
[/c]	|	<span class=color>
[c]	|	</span>
[i]	|	<I>
[/i]	|	</I>
[/m]	|	</div>
[m1]	|	<div class=m1>
[p]	|	<div>
[/p]	|	</div>
```

#### Формат макроса для замен с использованием регулярных выражений

```regex
^(.+?)\t\|(i?)\|\t(.*)$
```

Пример использования:  

```regex
\[(\/?)(b|i|u|sub|sup)\]	||	<$1$2>
\[i\]	||	
^(<[a-z]+>)$	|i|	$1
```

`|i|` - игнорировать регистр.  

Cписок специальных символов, которые в регулярных выражениях следует **обязательно** экранировать для превращения их в литеральные (если требуется):  

`[` `]` `\` `^` `$` `.` `|` `?` `*` `+` `(` `)`  

В **правой части макроса** эти символы **можно не экранировать**.  

Пример:

```regex
(\[\]\\\^\$\.\|\?\*\+\(\))	||	[]\^$.|?*+()$1
```

Символы `'` и `"` можно не экранировать в обеих частях.  

![warning.png](./../warning.png)
Точка в регулярном выражении обозначает любой символ, кроме перевода строки: `\n` `\r` `\u2028` or `\u2029`. Для поиска любого символа, включая переводы строк нужно использовать `[\s\S]` или `[^]`.

### Дополнительные примеры

Расстановка тэгов `[m1]`, `[/m]` в DSL файле:  

```regex
^([\t\x20]+)([^\t\x20].*)$	||	$1[m1]$2[/m]
```

_Возможный результат_:

```
абажур
        [m1]АБАЖ’УР[trn], -а, [p][c]м.[/c][/p] Колпак для лампы, светильника. [i]Зелёный а.[/i][/m]
        [m1][b]|[/b] [p][c]прил.[/c][/p] [b]абажурный[/b], -ая, -ое.[/trn][/m]
```

_Это регулярное выражение работает при построчной и постатейной обработке (-rt или -rd).</br>
Но в последнем случае файл должен иметь словарную структуру.</br>
И при постатейной обработке ^ - это не начало статьи (в данном случае), а $ - не конец.</br>
Ибо точка не захватывает_ `\n`. _Чтобы охватить всю статью надо заменить точку на_ `[^]`.

При использовании `[^]` вместо точки и постатейной обработке (-rd):

```regex
^([\t\x20]+)([^\t\x20][^]*)$	||	$1[m1]$2[/m]
```

_Результат будет таким_:  

```
абажур
        [m1]АБАЖ’УР[trn], -а, [p][c]м.[/c][/p] Колпак для лампы, светильника. [i]Зелёный а.[/i]
        [b]|[/b] [p][c]прил.[/c][/p] [b]абажурный[/b], -ая, -ое.[/trn][/m]
```

### Комментирование макросов

Скрипт игнорирует макросы в строках, которые начинаются с `//`.  

Пример:

```
//[b]	|	<B>
//\[i\]	||	
```

### Категории символов Unicode

`\p{L}`, `\P{L}`, `\p{N}`, `\P{Number}`, `\p{Greek}` и т. д.

Пример использования:  

```regex
(\p{L}+)	||	[i]$1[/i]
(\p{Lu}+)	||	[i]$1[/i]
(\p{Script=Latin}+)	||	[i]$1[/i]
(\p{Script=Greek}+)	||	[i]$1[/i]
(\p{Script=Cyrillic}+)	||	[i]$1[/i]
(\p{General_Category=Number}+)	||	[i]$1[/i]
```

Информацию для экспериментов с категориями можно брать отсюда:

* [Unicode Character Database](http://www.unicode.org/reports/tr44/)
* [Unicode® Character Name Index](http://www.unicode.org/charts/charindex.html)
* [Character Sets And Code Pages At The Push Of A Button](http://www.i18nguy.com/unicode/codepages.html)

<hr>
